'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author Pedro Sanders
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @since v1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */


var _utils = require('data_api/utils');

var _utils2 = _interopRequireDefault(_utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var MultipartConfigElement = Packages.javax.servlet.MultipartConfigElement;
var IOUtils = Packages.org.apache.commons.io.IOUtils;
var StandardCharsets = Packages.java.nio.charset.StandardCharsets;

var RestUtil = function () {
    function RestUtil() {
        _classCallCheck(this, RestUtil);
    }

    _createClass(RestUtil, null, [{
        key: 'createFromFile',
        value: function createFromFile(req, api) {
            if (req.contentType().indexOf('multipart/form-data') !== -1) {
                req.attribute('org.eclipse.jetty.multipartConfig', new MultipartConfigElement('/temp'));
                var is = req.raw().getPart('file').getInputStream();
                var fileContent = IOUtils.toString(is, StandardCharsets.UTF_8.name());
                var jsonObjs = _utils2.default.convertToJson(fileContent);
                var compoundResponse = '';
                jsonObjs.forEach(function (jsonObj) {
                    var response = api.createFromJSON(jsonObj);
                    compoundResponse = compoundResponse + '\n' + response.message;
                });
                return compoundResponse;
            } else {
                var jsonObj = JSON.parse(req.body());
                var response = api.createFromJSON(jsonObj);
                return JSON.stringify(response);
            }
        }
    }]);

    return RestUtil;
}();

exports.default = RestUtil;